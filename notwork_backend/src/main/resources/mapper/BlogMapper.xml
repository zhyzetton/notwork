<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.notwork.notwork_backend.mapper.BlogMapper">

    <select id="searchBlog" resultType="com.notwork.notwork_backend.entity.vo.BlogSearchVo">
        SELECT DISTINCT
            b.id,
            b.title,
            b.cover_url,
            b.status,
            b.view_count,
            b.like_count,
            b.collect_count,
            b.create_time,
            b.update_time,
            u.id AS user_id,
            u.username,
            u.avatar_url as user_avatar,
            t.tag_name
        FROM blog b
        JOIN user u ON b.user_id = u.id
        LEFT JOIN blog_tag_relation r on b.id = r.blog_id
        LEFT JOIN blog_tag t on r.tag_id = t.id
        <where>
            <if test="dto.title != null and dto.title != ''">
                AND b.title LIKE CONCAT('%', #{dto.title}, '%')
            </if>
            <if test="dto.tagId != null">
                AND r.tag_id = #{dto.tagId}
            </if>
            <if test="dto.tagCode != null">
                AND t.tag_code = #{dto.tagCode}
            </if>
            <if test="dto.status != null">
                AND b.status = #{dto.status}
            </if>
        </where>
        ORDER BY b.create_time DESC
    </select>
</mapper>
